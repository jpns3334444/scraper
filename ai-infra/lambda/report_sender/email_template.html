<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tokyo Real Estate Investment Analysis Report</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
            color: #2c3e50;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #ffffff;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);
            color: #ffffff;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 300;
        }
        
        .header .subtitle {
            margin: 10px 0 0 0;
            font-size: 16px;
            opacity: 0.9;
        }
        
        .header .date {
            margin: 5px 0 0 0;
            font-size: 14px;
            opacity: 0.8;
        }
        
        .summary-bar {
            background-color: #f7fafc;
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            text-align: center;
        }
        
        .stat-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #1a365d;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .content-section {
            padding: 30px;
        }
        
        .section-title {
            color: #2d3748;
            font-size: 24px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3182ce;
        }
        
        .alert-section {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .alert-title {
            color: #856404;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .property-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            margin-bottom: 25px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: box-shadow 0.3s ease;
        }
        
        .property-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .property-header {
            background: linear-gradient(90deg, #4299e1 0%, #3182ce 100%);
            color: white;
            padding: 20px;
            position: relative;
        }
        
        .property-id {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .property-type {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .investment-badge {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .property-body {
            padding: 25px;
        }
        
        .price-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .price-main {
            font-size: 24px;
            font-weight: bold;
            color: #e53e3e;
            margin-bottom: 5px;
        }
        
        .price-details {
            font-size: 14px;
            color: #718096;
        }
        
        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .detail-label {
            color: #718096;
            font-weight: 500;
        }
        
        .detail-value {
            color: #2d3748;
            font-weight: 600;
        }
        
        .analysis-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .analysis-title {
            color: #2d3748;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .recommendation {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
            text-align: center;
        }
        
        .recommendation.strong-buy {
            background-color: #c6f6d5;
            color: #22543d;
            border: 2px solid #68d391;
        }
        
        .recommendation.buy {
            background-color: #bee3f8;
            color: #2a4365;
            border: 2px solid #63b3ed;
        }
        
        .recommendation.hold {
            background-color: #fef5e7;
            color: #744210;
            border: 2px solid #f6ad55;
        }
        
        .recommendation.pass {
            background-color: #fed7d7;
            color: #742a2a;
            border: 2px solid #fc8181;
        }
        
        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }
        
        .tag {
            background: #e2e8f0;
            color: #4a5568;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .tag.positive {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .tag.negative {
            background: #fed7d7;
            color: #742a2a;
        }
        
        .footer {
            background-color: #2d3748;
            color: #a0aec0;
            padding: 30px;
            text-align: center;
        }
        
        .footer-title {
            color: #e2e8f0;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .disclaimer {
            font-size: 12px;
            line-height: 1.5;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .cta-button {
            display: inline-block;
            background: linear-gradient(135deg, #3182ce 0%, #2c5282 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: bold;
            margin: 10px 5px;
            transition: transform 0.2s ease;
        }
        
        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        @media (max-width: 600px) {
            .container {
                margin: 0;
            }
            
            .details-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 22px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Tokyo Real Estate Investment Analysis</h1>
            <div class="subtitle">AI-Powered Market Intelligence Report</div>
            <div class="date">{{ report_date }} | Batch: {{ batch_id }}</div>
        </div>
        
        <!-- Summary Statistics -->
        <div class="summary-bar">
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number">{{ successful_count }}</div>
                    <div class="stat-label">Properties Analyzed</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ strong_buy_count }}</div>
                    <div class="stat-label">Strong Buy Recommendations</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ buy_count }}</div>
                    <div class="stat-label">Buy Recommendations</div>
                </div>
                {% if failed_count > 0 %}
                <div class="stat-item">
                    <div class="stat-number">{{ failed_count }}</div>
                    <div class="stat-label">Processing Issues</div>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Processing Issues Alert -->
        {% if failed_properties %}
        <div class="alert-section">
            <div class="alert-title">⚠️ Processing Issues</div>
            <p>The following properties could not be fully analyzed due to data or processing issues:</p>
            <ul>
                {% for prop_id in failed_properties %}
                <li>{{ prop_id.split('-')[-1] }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        
        <!-- Property Analysis Reports -->
        <div class="content-section">
            <h2 class="section-title">📊 Property Analysis Results</h2>
            
            {% for report in property_reports %}
            <div class="property-card">
                <div class="property-header">
                    <div class="property-id">Property: {{ report.property_id }}</div>
                    <div class="property-type">Individual Analysis Report</div>
                    <div class="investment-badge">AI Analysis</div>
                </div>
                
                <div class="property-body">
                    {{ report.html_content | safe }}
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Market Insights -->
        {% if market_insights %}
        <div class="content-section">
            <h2 class="section-title">🏢 Market Insights</h2>
            <div class="analysis-section">
                <div class="analysis-title">Key Market Observations</div>
                {{ market_insights | safe }}
            </div>
        </div>
        {% endif %}
        
        <!-- Footer -->
        <div class="footer">
            <div class="footer-title">Tokyo Real Estate AI Analysis System</div>
            <div class="disclaimer">
                This report is generated by an AI system for informational and research purposes only. 
                All investment decisions should be based on thorough due diligence and consultation with 
                qualified real estate professionals. Property values, market conditions, and investment 
                potential can change rapidly. Past performance does not guarantee future results.
            </div>
        </div>
    </div>
</body>
</html>