<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>東京不動産 | Tokyo Real Estate</title>
    
    <!-- Sumi-e inspired Favicon with traditional seal -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' fill='%23fefefe'/><circle cx='16' cy='16' r='11' fill='none' stroke='%23333' stroke-width='1.5' stroke-dasharray='2,1' opacity='0.8'/><text x='16' y='21' text-anchor='middle' fill='%23333' font-family='serif' font-size='14' font-weight='200'>東</text></svg>">
    
    <!-- Preload Japanese Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@200;300;400&display=swap" rel="stylesheet">
    
    <!-- Styles with Sumi-e aesthetic -->
    <link rel="stylesheet" href="shared/styles/base.css">
    <link rel="stylesheet" href="shared/styles/layout.css">
    <link rel="stylesheet" href="shared/styles/components.css">
    <link rel="stylesheet" href="features/properties/properties.css">
    <link rel="stylesheet" href="features/favorites/favorites.css">
    <link rel="stylesheet" href="features/auth/auth.css">
    <link rel="stylesheet" href="features/hidden/hidden.css">
</head>
<body>
    <!-- SVG Filters for Sumi-e Effects -->
    <svg style="position: absolute; width: 0; height: 0;">
        <defs>
            <!-- Ink bleed effect -->
            <filter id="inkBleed">
                <feTurbulence type="fractalNoise" baseFrequency="0.1" numOctaves="1" result="turbulence"/>
                <feDisplacementMap in="SourceGraphic" in2="turbulence" scale="1.5"/>
                <feGaussianBlur stdDeviation="0.3"/>
            </filter>
            
            <!-- Brush texture -->
            <filter id="brushTexture">
                <feTurbulence type="fractalNoise" baseFrequency="0.5" numOctaves="3" result="noise"/>
                <feComposite operator="multiply" in="noise" in2="SourceGraphic"/>
            </filter>
            
            <!-- Paper texture -->
            <filter id="paperTexture">
                <feTurbulence type="fractalNoise" baseFrequency="0.02" numOctaves="4" result="noise"/>
                <feColorMatrix in="noise" type="saturate" values="0"/>
                <feComposite operator="multiply" in2="SourceGraphic"/>
            </filter>
        </defs>
    </svg>

    <!-- Bamboo/Reed decoration - positioned absolutely -->
    <div class="bamboo-decoration bamboo-left"></div>
    <div class="bamboo-decoration bamboo-right"></div>

    <!-- Floating ink drops -->
    <div class="ink-drop" style="left: 15%; animation-delay: 0s;"></div>
    <div class="ink-drop" style="left: 85%; animation-delay: 4s;"></div>
    <div class="ink-drop" style="left: 45%; animation-delay: 8s;"></div>

    <!-- Authentication Modal -->
    <div id="authModal" class="modal"></div>
    
    <!-- User Info Display -->
    <div id="userInfo" class="user-info" style="display: none;">
        <span id="userEmail"></span>
        <button onclick="logout()" class="ink-btn">ログアウト</button>
    </div>
    
    <!-- Sign In Button for Anonymous Users -->
    <div id="signInPrompt" class="user-info" style="display: none;">
        <button onclick="showAuthModal()" class="ink-btn">サインイン</button>
    </div>
    
    <!-- Error Banner -->
    <div id="errorBanner" class="error-banner" style="display: none;">
        <span id="errorMessage"></span>
        <button onclick="hideErrorBanner()">✕</button>
    </div>
    
    <div class="container">
        <!-- Title with traditional seal -->
        <div class="title-section">
            <h1>東京不動産</h1>
            <div class="red-seal">
                <svg viewBox="0 0 60 60">
                    <circle cx="30" cy="30" r="28" fill="none" stroke="currentColor" stroke-width="2"/>
                    <text x="30" y="38" text-anchor="middle" font-size="24">東</text>
                </svg>
            </div>
        </div>
        
        <!-- Tab Navigation aligned left -->
        <div class="tab-navigation" id="tabNavigation"></div>
        
        <!-- Properties Tab -->
        <div id="properties-tab" class="tab-pane active">
            <div class="loading" id="loading">
                <!-- Loading skeleton will be populated by PropertiesView -->
            </div>
            
            <div class="table-container" id="tableContainer" style="display: none;">
                <table>
                    <thead>
                        <!-- Table header will be populated by PropertiesView -->
                    </thead>
                    <tbody id="propertiesTable">
                        <!-- Table rows will be populated by PropertiesView -->
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            <div class="pagination-container" id="paginationContainer" style="display: none;">
                <div class="pagination" id="pagination"></div>
            </div>
        </div>
        
        <!-- Favorites Tab -->
        <div id="favorites-tab" class="tab-pane" style="display: none;">
            <div class="favorites-container" id="favoritesList"></div>
        </div>
        
        <!-- Hidden Tab -->
        <div id="hidden-tab" class="tab-pane" style="display: none;">
            <ul class="fav-list" id="hiddenList"></ul>
        </div>
    </div>
    
    <!-- Load JavaScript modules in correct order -->
    <script src="config/constants.js"></script>
    <script src="shared/utils/formatters.js"></script>
    <script src="shared/utils/storage.js"></script>
    <script src="shared/utils/dom.js"></script>
    <script src="core/api.js"></script>
    <script src="core/state.js"></script>
    <script src="core/router.js"></script>
    <script src="shared/components/Pagination.js"></script>
    <script src="shared/components/FilterDropdown.js"></script>
    <script src="shared/components/Table.js"></script>
    <script src="features/auth/AuthManager.js"></script>
    <script src="features/auth/AuthModal.js"></script>
    <script src="features/properties/PropertiesManager.js"></script>
    <script src="features/properties/PropertiesView.js"></script>
    <script src="features/favorites/FavoritesManager.js"></script>
    <script src="features/favorites/FavoritesView.js"></script>
    <script src="features/hidden/HiddenManager.js"></script>
    <script src="features/hidden/HiddenView.js"></script>
    <script src="main.js"></script>

    <!-- Sumi-e Interactions -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add ripple effect on clicks
            document.addEventListener('click', function(e) {
                if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
                    const ripple = document.createElement('div');
                    ripple.className = 'ink-ripple';
                    ripple.style.left = e.clientX + 'px';
                    ripple.style.top = e.clientY + 'px';
                    document.body.appendChild(ripple);
                    setTimeout(() => ripple.remove(), 1000);
                }
            });

            // Subtle ink flow on hover
            document.addEventListener('mousemove', function(e) {
                const cards = document.querySelectorAll('.favorite-card, tr');
                cards.forEach(card => {
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    if (x >= 0 && x <= rect.width && y >= 0 && y <= rect.height) {
                        card.style.setProperty('--mouse-x', `${x}px`);
                        card.style.setProperty('--mouse-y', `${y}px`);
                    }
                });
            });
        });
    </script>
</body>
</html>