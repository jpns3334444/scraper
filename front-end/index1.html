<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>東京 Real Estate</title>
    
    <!-- Japanese-inspired Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' fill='%23F7F5F2'/><circle cx='16' cy='16' r='10' fill='%23695b8d' opacity='0.8'/></svg>">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+Antique:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap');
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Noto Sans JP', 'Hiragino Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #F7F5F2;
            color: #222222;
            line-height: 1.7;
            font-size: 15px;
            overflow-x: hidden;
            position: relative;
            font-weight: 400;
        }
        
        /* Subtle Mt. Fuji background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            right: 0;
            width: 600px;
            height: 400px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 400"><path d="M300 100 L200 300 L400 300 Z" fill="%23e8e4e0" opacity="0.06"/><path d="M300 100 L250 200 L350 200 Z" fill="%23ffffff" opacity="0.08"/></svg>');
            background-repeat: no-repeat;
            background-position: top right;
            background-size: contain;
            pointer-events: none;
            z-index: 0;
        }
        
        .container {
            max-width: none;
            width: 100%;
            margin: 0;
            padding: 40px 9px;
            position: relative;
            z-index: 10;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
        }
        
        h1 {
            color: #222222;
            margin-bottom: 40px;
            font-size: 48px;
            font-weight: 700;
            text-align: center;
            font-family: 'Zen Kaku Gothic Antique', serif;
            letter-spacing: 0.15em;
            position: relative;
            padding-bottom: 20px;
        }
        
        /* Brushstroke underline */
        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 3px;
            background: linear-gradient(90deg, transparent 0%, #695b8d 20%, #695b8d 80%, transparent 100%);
            border-radius: 2px;
        }
        
        .results-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 16px 24px;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
            position: relative;
        }
        
        .results-count {
            font-size: 14px;
            color: #666666;
            font-weight: 400;
            font-family: 'Noto Sans JP', sans-serif;
        }
        
        /* Table Container */
        .table-container {
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
            overflow: visible;
            position: relative;
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-family: 'Noto Sans JP', sans-serif;
            table-layout: fixed;
        }
        
        th {
            background: #f1eee8;
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 10;
            font-weight: 700;
            font-size: 13px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #333333;
            border-bottom: 1px solid #cccccc;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        thead th {
            position: sticky;
            top: 0;
            background: #f1eee8;
            z-index: 20;
        }
        
        th.sortable {
            user-select: none;
        }
        
        .column-header {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 14px 16px;
            cursor: pointer;
            min-height: 45px;
            transition: all 120ms ease;
            position: relative;
        }
        
        .column-header:hover {
            background: rgba(105, 91, 141, 0.05);
        }
        
        .sort-arrows {
            font-size: 11px;
            color: #999999;
            margin-left: 6px;
            transition: all 120ms ease;
        }
        
        .sort-arrows.active {
            color: #695b8d;
            font-weight: 700;
        }
        
        td {
            border-bottom: 1px solid #f0f0f0;
            padding: 14px 16px;
            font-size: 14px;
            vertical-align: middle;
            color: #333333;
            font-family: 'Noto Sans JP', sans-serif;
            font-weight: 400;
            position: relative;
            word-break: break-word;
        }
        
        /* Zebra striping */
        tbody tr:nth-child(odd) td {
            background: #ffffff;
        }
        
        tbody tr:nth-child(even) td {
            background: #fafaf8;
        }
        
        tbody tr {
            transition: all 120ms ease;
            animation: fadeInUp 0.3s ease-out;
        }
        
        @keyframes fadeInUp {
            0% {
                opacity: 0;
                transform: translateY(10px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* First and last cell rounded corners */
        tbody tr td:first-child {
            border-top-left-radius: 4px;
            border-bottom-left-radius: 4px;
        }
        
        tbody tr td:last-child {
            border-top-right-radius: 4px;
            border-bottom-right-radius: 4px;
        }
        
        /* Hover state */
        tbody tr:hover td {
            background: #f3f0f8 !important;
            transform: translateY(-1px) scale(1.002);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
        }
        
        /* Clickable row */
        tbody tr {
            cursor: pointer;
        }
        
        tbody tr.no-link {
            cursor: default;
        }
        
        .property-image {
            width: 50px;
            height: 38px;
            object-fit: cover;
            border-radius: 4px;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #999999;
            border: 1px solid #e0e0e0;
            font-family: 'Noto Sans JP', sans-serif;
            overflow: hidden;
        }
        
        .skull-icon {
            color: #cccccc;
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 16px;
            display: inline-block;
        }
        
        .price {
            font-weight: 500;
            color: #333333;
            text-align: right;
            font-size: 15px;
            font-family: 'Noto Sans JP', sans-serif;
        }
        
        .numeric {
            text-align: center;
            font-weight: 500;
        }
        
        .percent {
            text-align: center;
            font-weight: 500;
            font-family: monospace;
        }
        
        .age {
            text-align: center;
            color: #666666;
        }
        
        .no-data {
            color: #cccccc;
            font-style: italic;
        }
        
        .verdict {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            text-align: center;
            letter-spacing: 0.1em;
            transition: all 120ms ease;
            font-family: 'Noto Sans JP', sans-serif;
            position: relative;
            border: 1px solid transparent;
        }
        
        .verdict-buy, .verdict-strong_buy {
            background: #e6f4ea;
            color: #2e7d32;
            border-color: #2e7d32;
        }
        
        .verdict-hold {
            background: #fff4e5;
            color: #b26a00;
            border-color: #b26a00;
        }
        
        .verdict-pass {
            background: #fdecea;
            color: #c62828;
            border-color: #c62828;
        }
        
        .verdict:hover {
            transform: scale(1.02);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }
        
        .link-button {
            color: #333333;
            text-decoration: none;
            font-weight: 400;
            font-size: 12px;
            font-family: 'Noto Sans JP', sans-serif;
            padding: 6px 12px;
            border: 1px solid #cccccc;
            border-radius: 4px;
            background: transparent;
            transition: all 120ms ease;
            display: inline-block;
        }
        
        .link-button:hover {
            background: #f3f0f8;
            border-color: #695b8d;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        /* Scroll sentinel */
        #scrollSentinel {
            height: 20px;
            margin-top: 20px;
        }
        
        /* Status Bar */
        .terminal-status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
            border-top: 1px solid #e0e0e0;
            padding: 12px 24px;
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 12px;
            color: #666666;
            z-index: 999;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.04);
        }
        
        .status-left, .status-right {
            display: flex;
            gap: 24px;
        }
        
        .status-item {
            color: #666666;
        }
        
        /* Loading */
        .loading {
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
            overflow: hidden;
            position: relative;
            padding: 24px;
        }
        
        .loading::before {
            content: 'Loading properties...';
            position: absolute;
            top: 20px;
            left: 24px;
            color: #999999;
            font-size: 13px;
            font-family: 'Noto Sans JP', sans-serif;
        }
        
        .skeleton {
            animation: skeleton-loading 1.5s infinite ease-in-out;
        }
        
        .skeleton-row {
            display: flex;
            padding: 14px 16px;
            border-bottom: 1px solid #f0f0f0;
            margin-top: 40px;
        }
        
        .skeleton-cell {
            height: 20px;
            background: linear-gradient(90deg, 
                #f5f5f5 0%, 
                #eeeeee 25%, 
                #f5f5f5 50%, 
                #eeeeee 75%,
                #f5f5f5 100%
            );
            background-size: 200% 100%;
            border-radius: 4px;
            margin-right: 12px;
            position: relative;
        }
        
        .skeleton-cell:last-child {
            margin-right: 0;
        }
        
        .skeleton-cell.link { width: 80px; }
        .skeleton-cell.price { width: 120px; }
        .skeleton-cell.ward { width: 100px; }
        .skeleton-cell.percent { width: 80px; }
        .skeleton-cell.station { width: 120px; }
        .skeleton-cell.numeric { width: 80px; }
        .skeleton-cell.age { width: 100px; }
        .skeleton-cell.light { width: 100px; }
        .skeleton-cell.verdict { width: 80px; }
        
        @keyframes skeleton-loading {
            0% { 
                background-position: -200% 0;
            }
            100% { 
                background-position: 200% 0;
            }
        }
        
        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab-button {
            padding: 10px 20px;
            border: none;
            background: none;
            cursor: pointer;
            position: relative;
            color: #666666;
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 14px;
            transition: all 120ms ease;
        }
        
        .tab-button.active {
            color: #695b8d;
            border-bottom: 3px solid #695b8d;
        }
        
        .tab-button:hover {
            color: #695b8d;
        }
        
        .favorites-count {
            background: #e91e63;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 12px;
            margin-left: 5px;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        /* Heart Button */
        .heart-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            padding: 4px 8px;
            transition: all 0.2s;
            color: #cccccc;
        }
        
        .heart-btn.favorited {
            color: #e91e63;
        }
        
        .heart-btn:hover {
            transform: scale(1.1);
        }
        
        .heart-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Hide Button */
        .hide-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 4px 6px;
            transition: all 0.2s;
            color: #cccccc;
            margin-left: 4px;
        }
        
        .hide-btn:hover {
            color: #999999;
            transform: scale(1.1);
        }
        
        .hide-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Favorites Grid */
        .favorites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }
        
        .favorite-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s;
            background: #ffffff;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
        }
        
        .favorite-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .favorite-image {
            height: 200px;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .favorite-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .no-image {
            color: #999999;
            font-size: 14px;
        }
        
        .favorite-details {
            padding: 15px;
        }
        
        .favorite-price {
            font-size: 18px;
            font-weight: 600;
            color: #333333;
            margin-bottom: 8px;
        }
        
        .favorite-location {
            color: #666666;
            margin-bottom: 4px;
        }
        
        .favorite-size {
            color: #666666;
            margin-bottom: 10px;
        }
        
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            text-align: center;
            font-weight: 500;
        }
        
        .status-completed {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .status-processing {
            background: #fef5e7;
            color: #744210;
        }
        
        .status-failed {
            background: #fed7d7;
            color: #742a2a;
        }
        
        .status-pending {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        /* Favorites container and card styles */
        .favorites-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding: 20px 0;
        }
        
        .favorite-card {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 16px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .favorite-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        
        .favorite-image-section {
            width: 120px;
            height: 90px;
            margin-right: 20px;
            border-radius: 6px;
            overflow: hidden;
            background: #f5f5f5;
            flex-shrink: 0;
            position: relative;
        }
        
        .favorite-image-section img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .favorite-image-section .image-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #999;
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
        }
        
        .favorite-details-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .favorite-ward {
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }
        
        .favorite-price {
            font-size: 18px;
            font-weight: bold;
            color: #695b8d;
        }
        
        .favorite-size {
            color: #666;
            font-size: 14px;
        }
        
        .favorite-status-section {
            margin-left: auto;
            padding-left: 20px;
        }
        
        .processing-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .processing-status.processing {
            background: #fff4e5;
            color: #b26a00;
        }
        
        .processing-status.processed {
            background: #e6f4ea;
            color: #2e7d32;
            cursor: pointer;
            text-decoration: underline;
        }
        
        .processing-status.failed {
            background: #fdecea;
            color: #c62828;
        }
        
        .remove-favorite-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            color: #999;
            padding: 0;
        }
        
        .remove-favorite-btn:hover {
            background: #ff4444;
            color: white;
            border-color: #ff4444;
            transform: scale(1.1);
        }
        
        .favorites-empty {
            padding: 40px;
            text-align: center;
            color: #999;
            font-style: italic;
        }
        
        .fav-status.completed {
            color: #22543d;
            cursor: pointer;
            text-decoration: underline;
        }
        
        .fav-status.completed:hover {
            color: #276749;
        }

        /* New Favorites Card Layout */
        .favorites-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding: 20px 0;
        }
        
        .favorite-card {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 16px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .favorite-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        
        .favorite-image-section {
            width: 120px;
            height: 90px;
            margin-right: 20px;
            border-radius: 6px;
            overflow: hidden;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .favorite-image-section img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .favorite-image-section.no-image {
            background: #f0f0f0;
            color: #999;
            font-size: 12px;
            text-align: center;
        }
        
        .favorite-details-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .favorite-ward {
            font-weight: 600;
            color: #333;
        }
        
        .favorite-price {
            font-size: 18px;
            font-weight: bold;
            color: #695b8d;
        }
        
        .favorite-size {
            color: #666;
        }
        
        .favorite-status-section {
            margin-left: auto;
            padding-left: 20px;
        }
        
        .processing-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .processing-status.processing {
            background: #fff4e5;
            color: #b26a00;
        }
        
        .processing-status.processed {
            background: #e6f4ea;
            color: #2e7d32;
            cursor: pointer;
            text-decoration: underline;
        }
        
        .processing-status.failed {
            background: #fdecea;
            color: #c62828;
        }
        
        .remove-favorite-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            color: #999;
        }
        
        .remove-favorite-btn:hover {
            background: #ff4444;
            color: white;
            border-color: #ff4444;
            transform: scale(1.1);
        }
        
        .remove-favorite-btn svg {
            stroke-width: 2;
        }

        
        /* Column Filter Dropdown */
        .filter-dropdown {
            position: relative;
            display: inline-block;
            margin-left: 8px;
        }
        
        .filter-btn {
            background: none;
            border: none;
            font-size: 12px;
            color: #999999;
            cursor: pointer;
            padding: 2px 6px;
            transition: all 120ms ease;
        }
        
        .filter-btn:hover {
            color: #695b8d;
            background: rgba(105, 91, 141, 0.1);
            border-radius: 4px;
        }
        
        .filter-btn.active {
            color: #695b8d;
            font-weight: 700;
        }
        
        .filter-dropdown-content {
            display: none;
            position: absolute;
            background: #ffffff;
            min-width: 160px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 30;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-top: 4px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .filter-dropdown-content.show {
            display: block;
        }
        
        .filter-dropdown-content label {
            display: block;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 13px;
            transition: all 120ms ease;
        }
        
        .filter-dropdown-content label:hover {
            background: #f3f0f8;
        }
        
        .filter-dropdown-content input[type="checkbox"] {
            margin-right: 8px;
        }
        
        .filter-dropdown-content .filter-actions {
            padding: 8px 12px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 8px;
        }
        
        .filter-dropdown-content button {
            padding: 4px 8px;
            font-size: 12px;
            border: 1px solid #cccccc;
            background: #ffffff;
            border-radius: 4px;
            cursor: pointer;
            transition: all 120ms ease;
        }
        
        .filter-dropdown-content button:hover {
            background: #f3f0f8;
        }
        
        /* Pagination at bottom */
        .pagination-container {
            margin-top: 20px;
            padding: 20px;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .pagination button {
            padding: 6px 12px;
            border: 1px solid #cccccc;
            background: #ffffff;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: all 120ms ease;
            font-family: 'Noto Sans JP', sans-serif;
        }
        
        .pagination button:hover:not(:disabled) {
            background: #f3f0f8;
            border-color: #695b8d;
        }
        
        .pagination button.active {
            background: #695b8d;
            color: #ffffff;
            border-color: #695b8d;
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination .page-info {
            font-size: 13px;
            color: #666666;
            margin: 0 8px;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            body::before {
                width: 300px;
                height: 200px;
            }
            
            .container {
                padding: 20px 4.5px;
                margin: 0;
                border-radius: 8px;
            }
            
            h1 {
                font-size: 32px;
                margin-bottom: 24px;
            }
            
            .results-info {
                flex-direction: column;
                gap: 10px;
                padding: 12px 16px;
            }
            
            td {
                padding: 10px 12px;
                font-size: 13px;
            }
            
            .price {
                font-size: 14px;
            }
            
            .link-button {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .terminal-status-bar {
                font-size: 11px;
                padding: 8px 12px;
            }
            
            .status-left, .status-right {
                gap: 12px;
            }
        }
        
        /* Authentication Modal Styles */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 40px;
            border: 1px solid #ddd;
            width: 400px;
            max-width: 90%;
            border-radius: 8px;
            font-family: 'Noto Sans JP', sans-serif;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal h2 {
            margin-bottom: 24px;
            color: #333;
            font-size: 24px;
            font-weight: 700;
            text-align: center;
        }
        
        .modal input {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-family: 'Noto Sans JP', sans-serif;
            transition: border-color 0.2s;
        }
        
        .modal input:focus {
            outline: none;
            border-color: #695b8d;
        }
        
        .modal button {
            width: 100%;
            padding: 12px;
            background: #695b8d;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 16px;
            font-family: 'Noto Sans JP', sans-serif;
            font-weight: 500;
            transition: background 0.2s;
        }
        
        .modal button:hover {
            background: #574a75;
        }
        
        .auth-switch {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #666;
        }
        
        .auth-switch a {
            color: #695b8d;
            text-decoration: none;
            font-weight: 500;
        }
        
        .auth-switch a:hover {
            text-decoration: underline;
        }
        
        .error-message {
            color: #d32f2f;
            margin-top: 10px;
            font-size: 14px;
            text-align: center;
        }
        
        /* User info display */
        .user-info {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: white;
            padding: 8px 16px;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-info span {
            color: #666;
            font-size: 14px;
        }
        
        .user-info button {
            padding: 6px 12px;
            background: #695b8d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }
        
        .user-info button:hover {
            background: #574a75;
        }
        
        /* Error Banner */
        .error-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #ff4444;
            color: white;
            padding: 12px 20px;
            z-index: 1001;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .error-banner button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 18px;
            padding: 0;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <!-- Authentication Modal -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <h2 id="authTitle">Sign In</h2>
            <form id="authForm">
                <input type="email" id="email" placeholder="Email" required>
                <input type="password" id="password" placeholder="Password" required>
                <button type="submit" id="authSubmit">Sign In</button>
            </form>
            <p class="auth-switch">
                <span id="authSwitchText">Don't have an account?</span>
                <a href="#" id="authSwitchLink">Sign Up</a>
            </p>
            <div id="authError" class="error-message"></div>
        </div>
    </div>
    
    <!-- User Info Display -->
    <div id="userInfo" class="user-info" style="display: none;">
        <span id="userEmail"></span>
        <button onclick="logout()">Logout</button>
    </div>
    
    <!-- Sign In Button for Anonymous Users -->
    <div id="signInPrompt" class="user-info" style="display: none;">
        <button onclick="document.getElementById('authModal').style.display = 'block'">Sign In</button>
    </div>
    
    <!-- Error Banner -->
    <div id="errorBanner" class="error-banner" style="display: none;">
        <span id="errorMessage"></span>
        <button onclick="hideErrorBanner()">✕</button>
    </div>
    
    <div class="container">
        <h1>東京 Real Estate</h1>
        
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" onclick="switchTab('properties')">
                All Properties
            </button>
            <button class="tab-button" onclick="switchTab('favorites')">
                Favorites <span class="favorites-count" id="favoritesCount">0</span>
            </button>
            <button class="tab-button" onclick="switchTab('hidden')">
                Hidden <span class="favorites-count" id="hiddenCount" style="background: #999;">0</span>
            </button>
        </div>

        <!-- Properties Tab -->
        <div id="properties-tab" class="tab-pane active">
            <div class="results-info">
                <div class="results-count" id="resultsCount">Loading properties...</div>
            </div>
        </div>

        <!-- Favorites Tab -->
        <div id="favorites-tab" class="tab-pane" style="display: none;">
            <!-- Debug banner -->
            <div style="background: #ffe0e0; border: 2px solid #ff0000; padding: 10px; margin-bottom: 10px; color: #000; font-weight: bold;">
                DEBUG: Favorites Tab Container (This message should be visible when Favorites tab is active)
                <span id="favDebugCount" style="margin-left: 20px;"></span>
            </div>
            <div class="favorites-container" id="favoritesList"></div>
        </div>
        
        <!-- Hidden Tab -->
        <div id="hidden-tab" class="tab-pane" style="display: none;">
            <!-- Debug banner -->
            <div style="background: #e0e0ff; border: 2px solid #0000ff; padding: 10px; margin-bottom: 10px; color: #000; font-weight: bold;">
                DEBUG: Hidden Tab Container (This message should be visible when Hidden tab is active)
                <span id="hiddenDebugCount" style="margin-left: 20px;"></span>
            </div>
            <ul class="fav-list" id="hiddenList" style="border: 2px dashed #ff00ff; min-height: 50px; background: #fff0ff;"></ul>
        </div>
        
        <div class="loading" id="loading">
            <div class="skeleton-row">
                <div class="skeleton-cell numeric skeleton" style="width: 40px;"></div>
                <div class="skeleton-cell price skeleton"></div>
                <div class="skeleton-cell price skeleton"></div>
                <div class="skeleton-cell price skeleton"></div>
                <div class="skeleton-cell ward skeleton"></div>
                <div class="skeleton-cell percent skeleton"></div>
                <div class="skeleton-cell price skeleton"></div>
                <div class="skeleton-cell station skeleton"></div>
                <div class="skeleton-cell numeric skeleton"></div>
                <div class="skeleton-cell numeric skeleton"></div>
                <div class="skeleton-cell age skeleton"></div>
                <div class="skeleton-cell numeric skeleton"></div>
                <div class="skeleton-cell light skeleton"></div>
                <div class="skeleton-cell verdict skeleton"></div>
            </div>
            <div class="skeleton-row">
                <div class="skeleton-cell numeric skeleton" style="width: 40px;"></div>
                <div class="skeleton-cell price skeleton"></div>
                <div class="skeleton-cell price skeleton"></div>
                <div class="skeleton-cell price skeleton"></div>
                <div class="skeleton-cell ward skeleton"></div>
                <div class="skeleton-cell percent skeleton"></div>
                <div class="skeleton-cell price skeleton"></div>
                <div class="skeleton-cell station skeleton"></div>
                <div class="skeleton-cell numeric skeleton"></div>
                <div class="skeleton-cell numeric skeleton"></div>
                <div class="skeleton-cell age skeleton"></div>
                <div class="skeleton-cell numeric skeleton"></div>
                <div class="skeleton-cell light skeleton"></div>
                <div class="skeleton-cell verdict skeleton"></div>
            </div>
            <div class="skeleton-row">
                <div class="skeleton-cell numeric skeleton" style="width: 40px;"></div>
                <div class="skeleton-cell price skeleton"></div>
                <div class="skeleton-cell price skeleton"></div>
                <div class="skeleton-cell price skeleton"></div>
                <div class="skeleton-cell ward skeleton"></div>
                <div class="skeleton-cell percent skeleton"></div>
                <div class="skeleton-cell price skeleton"></div>
                <div class="skeleton-cell station skeleton"></div>
                <div class="skeleton-cell numeric skeleton"></div>
                <div class="skeleton-cell numeric skeleton"></div>
                <div class="skeleton-cell age skeleton"></div>
                <div class="skeleton-cell numeric skeleton"></div>
                <div class="skeleton-cell light skeleton"></div>
                <div class="skeleton-cell verdict skeleton"></div>
            </div>
        </div>
        
        <div class="table-container" id="tableContainer" style="display: none;">
            <table>
                <thead>
                    <tr>
                        <th style="width: 80px;">♥/✕</th>
                        <th class="sortable" onclick="sortTable('price')">
                            <div class="column-header">
                                Price
                                <span class="sort-arrows" id="sort-price">▲▼</span>
                            </div>
                        </th>
                        <th class="sortable" onclick="sortTable('price_per_sqm')">
                            <div class="column-header">
                                Price/m²
                                <span class="sort-arrows" id="sort-price_per_sqm">▲▼</span>
                            </div>
                        </th>
                        <th class="sortable" onclick="sortTable('total_monthly_costs')">
                            <div class="column-header">
                                Monthly Cost
                                <span class="sort-arrows" id="sort-total_monthly_costs">▲▼</span>
                            </div>
                        </th>
                        <th class="sortable" onclick="sortTable('ward')">
                            <div class="column-header">
                                Ward
                                <span class="sort-arrows" id="sort-ward">▲▼</span>
                                <div class="filter-dropdown">
                                    <button class="filter-btn" onclick="toggleFilterDropdown(event, 'ward')" id="filter-btn-ward">▼</button>
                                    <div class="filter-dropdown-content" id="filter-dropdown-ward">
                                        <div id="ward-filter-options"></div>
                                        <div class="filter-actions">
                                            <button onclick="applyColumnFilter('ward')">Apply</button>
                                            <button onclick="clearColumnFilter('ward')">Clear</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </th>
                        <th class="sortable" onclick="sortTable('ward_discount_pct')">
                            <div class="column-header">
                                Ward Discount %
                                <span class="sort-arrows" id="sort-ward_discount_pct">▲▼</span>
                            </div>
                        </th>
                        <th class="sortable" onclick="sortTable('ward_median_price_per_sqm')">
                            <div class="column-header">
                                Ward Median ¥/m²
                                <span class="sort-arrows" id="sort-ward_median_price_per_sqm">▲▼</span>
                            </div>
                        </th>
                        <th>Closest Station</th>
                        <th class="sortable" onclick="sortTable('station_distance_minutes')">
                            <div class="column-header">
                                Walk Time (min)
                                <span class="sort-arrows" id="sort-station_distance_minutes">▲▼</span>
                            </div>
                        </th>
                        <th class="sortable" onclick="sortTable('floor')">
                            <div class="column-header">
                                Floor
                                <span class="sort-arrows" id="sort-floor">▲▼</span>
                            </div>
                        </th>
                        <th class="sortable" onclick="sortTable('building_age_years')">
                            <div class="column-header">
                                Building Age
                                <span class="sort-arrows" id="sort-building_age_years">▲▼</span>
                            </div>
                        </th>
                        <th class="sortable" onclick="sortTable('size_sqm')">
                            <div class="column-header">
                                Size (m²)
                                <span class="sort-arrows" id="sort-size_sqm">▲▼</span>
                            </div>
                        </th>
                        <th>
                            <div class="column-header">
                                Primary Light
                                <div class="filter-dropdown">
                                    <button class="filter-btn" onclick="toggleFilterDropdown(event, 'primary_light')" id="filter-btn-primary_light">▼</button>
                                    <div class="filter-dropdown-content" id="filter-dropdown-primary_light">
                                        <div id="primary_light-filter-options"></div>
                                        <div class="filter-actions">
                                            <button onclick="applyColumnFilter('primary_light')">Apply</button>
                                            <button onclick="clearColumnFilter('primary_light')">Clear</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </th>
                        <th>
                            <div class="column-header">
                                Verdict
                                <div class="filter-dropdown">
                                    <button class="filter-btn" onclick="toggleFilterDropdown(event, 'verdict')" id="filter-btn-verdict">▼</button>
                                    <div class="filter-dropdown-content" id="filter-dropdown-verdict">
                                        <div id="verdict-filter-options"></div>
                                        <div class="filter-actions">
                                            <button onclick="applyColumnFilter('verdict')">Apply</button>
                                            <button onclick="clearColumnFilter('verdict')">Clear</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </th>
                    </tr>
                </thead>
                <tbody id="propertiesTable">
                </tbody>
            </table>
        </div>
        
        <!-- Pagination at bottom -->
        <div class="pagination-container" id="paginationContainer" style="display: none;">
            <div class="pagination" id="pagination"></div>
        </div>
    </div>
