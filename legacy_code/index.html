<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>東京 Real Estate</title>
    
    <!-- Japanese-inspired Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' fill='%23f4f1ed'/><circle cx='16' cy='16' r='10' fill='%23c62828' opacity='0.8'/></svg>">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Noto+Serif+JP:wght@400;700&family=Playfair+Display:wght@400;700&display=swap');
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Noto Sans JP', 'Hiragino Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f4f1ed;
            color: #222222;
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
            font-weight: 400;
        }
        
        /* Subtle Mt. Fuji background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            right: 0;
            width: 600px;
            height: 400px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 400"><path d="M300 100 L200 300 L400 300 Z" fill="%23e8e4e0" opacity="0.06"/><path d="M300 100 L250 200 L350 200 Z" fill="%23ffffff" opacity="0.08"/></svg>');
            background-repeat: no-repeat;
            background-position: top right;
            background-size: contain;
            pointer-events: none;
            z-index: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 30px;
            position: relative;
            z-index: 10;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        
        h1 {
            color: #222222;
            margin-bottom: 40px;
            font-size: 48px;
            font-weight: 400;
            text-align: center;
            font-family: 'Noto Serif JP', 'Playfair Display', serif;
            letter-spacing: 0.15em;
            position: relative;
            padding-bottom: 20px;
        }
        
        /* Brushstroke underline */
        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 3px;
            background: linear-gradient(90deg, transparent 0%, #333333 20%, #333333 80%, transparent 100%);
            border-radius: 2px;
        }
        
        .results-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 16px 24px;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            position: relative;
        }
        
        .results-count {
            font-size: 14px;
            color: #666666;
            font-weight: 400;
            font-family: 'Noto Sans JP', sans-serif;
        }
        
        /* Table Container */
        .table-container {
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            overflow: auto;
            max-height: 75vh;
            position: relative;
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 1200px;
            font-family: 'Noto Sans JP', sans-serif;
        }
        
        th {
            background: #f1eee8;
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 10;
            font-weight: 700;
            font-size: 13px;
            text-align: left;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #333333;
            border-bottom: 1px solid #cccccc;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        th.sortable {
            user-select: none;
        }
        
        .column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            cursor: pointer;
            min-height: 45px;
            transition: all 200ms ease;
            position: relative;
        }
        
        .column-header:hover {
            background: rgba(0, 0, 0, 0.03);
        }
        
        .sort-arrows {
            font-size: 11px;
            color: #999999;
            margin-left: 6px;
            transition: all 200ms ease;
        }
        
        .sort-arrows.active {
            color: #333333;
            font-weight: 700;
        }
        
        .filter-row {
            background-color: #fafbfc;
            border-bottom: 2px solid #ddd;
        }
        
        .filter-cell {
            padding: 4px 8px;
            border-right: 1px solid #ddd;
            position: relative;
        }
        
        .filter-btn {
            background: none;
            border: none;
            font-size: 12px;
            color: #666;
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 2px;
        }
        
        .filter-btn:hover {
            background-color: #e8eaed;
        }
        
        .filter-btn.active {
            background-color: #3b82f6;
            color: white;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .filter-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 200px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        
        .filter-content {
            padding: 10px;
        }
        
        .filter-content label {
            display: block;
            margin: 4px 0;
            font-size: 12px;
            cursor: pointer;
        }
        
        .filter-content input[type="checkbox"] {
            margin-right: 6px;
        }
        
        .filter-content input[type="number"] {
            width: 80px;
            padding: 2px 4px;
            margin: 2px;
            border: 1px solid #ccc;
            border-radius: 2px;
            font-size: 12px;
        }
        
        .filter-actions {
            padding: 8px 10px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 8px;
        }
        
        .filter-actions button {
            padding: 4px 12px;
            border: 1px solid #ccc;
            border-radius: 2px;
            background: white;
            font-size: 11px;
            cursor: pointer;
        }
        
        .filter-actions button:hover {
            background-color: #f5f5f5;
        }
        
        .filter-actions .apply-btn {
            background-color: #1976d2;
            color: white;
            border-color: #1976d2;
        }
        
        .filter-actions .apply-btn:hover {
            background-color: #1565c0;
        }
        
        td {
            border-bottom: 1px solid #f0f0f0;
            padding: 14px 16px;
            font-size: 14px;
            vertical-align: middle;
            color: #333333;
            font-family: 'Noto Sans JP', sans-serif;
            font-weight: 400;
            position: relative;
        }
        
        /* Zebra striping */
        tbody tr:nth-child(odd) td {
            background: #ffffff;
        }
        
        tbody tr:nth-child(even) td {
            background: #f7f6f2;
        }
        
        tbody tr {
            transition: all 200ms ease;
        }
        
        /* First and last cell rounded corners */
        tbody tr td:first-child {
            border-top-left-radius: 4px;
            border-bottom-left-radius: 4px;
        }
        
        tbody tr td:last-child {
            border-top-right-radius: 4px;
            border-bottom-right-radius: 4px;
        }
        
        /* Hover state */
        tbody tr:hover td {
            background: #eceae4 !important;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .property-image {
            width: 50px;
            height: 38px;
            object-fit: cover;
            border-radius: 4px;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #999999;
            border: 1px solid #e0e0e0;
            font-family: 'Noto Sans JP', sans-serif;
            overflow: hidden;
        }
        
        .skull-icon {
            color: #cccccc;
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 16px;
            display: inline-block;
        }
        
        .price {
            font-weight: 500;
            color: #333333;
            text-align: right;
            font-size: 15px;
            font-family: 'Noto Sans JP', sans-serif;
        }
        
        .verdict {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            text-align: center;
            letter-spacing: 0.1em;
            transition: all 200ms ease;
            font-family: 'Noto Sans JP', sans-serif;
            position: relative;
            border: 1px solid transparent;
        }
        
        .verdict-buy, .verdict-strong_buy {
            background: #e6f4ea;
            color: #2e7d32;
            border-color: #2e7d32;
        }
        
        .verdict-hold {
            background: #fff4e5;
            color: #b26a00;
            border-color: #b26a00;
        }
        
        .verdict-pass {
            background: #fdecea;
            color: #c62828;
            border-color: #c62828;
        }
        
        .verdict:hover {
            transform: scale(1.02);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }
        
        .link-button {
            color: #333333;
            text-decoration: none;
            font-weight: 400;
            font-size: 12px;
            font-family: 'Noto Sans JP', sans-serif;
            padding: 6px 12px;
            border: 1px solid #cccccc;
            border-radius: 4px;
            background: transparent;
            transition: all 200ms ease;
            display: inline-block;
        }
        
        .link-button:hover {
            background: #eceae4;
            border-color: #999999;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 30px;
            padding: 20px;
        }
        
        .pagination button {
            padding: 8px 16px;
            border: 1px solid #cccccc;
            background: #ffffff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 400;
            font-family: 'Noto Sans JP', sans-serif;
            color: #333333;
            transition: all 200ms ease;
        }
        
        .pagination button:hover:not(:disabled) {
            background: #f5f5f5;
            border-color: #999999;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            color: #999999;
            border-color: #e0e0e0;
        }
        
        .page-info {
            font-size: 13px;
            color: #666666;
            font-family: 'Noto Sans JP', sans-serif;
        }
        
        
        /* Status Bar */
        .terminal-status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
            border-top: 1px solid #e0e0e0;
            padding: 12px 24px;
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 12px;
            color: #666666;
            z-index: 999;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .status-left, .status-right {
            display: flex;
            gap: 24px;
        }
        
        .status-item {
            color: #666666;
        }
        
        /* Loading */
        .loading {
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            position: relative;
            padding: 24px;
        }
        
        .loading::before {
            content: 'Loading properties...';
            position: absolute;
            top: 20px;
            left: 24px;
            color: #999999;
            font-size: 13px;
            font-family: 'Noto Sans JP', sans-serif;
        }
        
        .skeleton {
            animation: skeleton-loading 1.5s infinite ease-in-out;
        }
        
        .skeleton-row {
            display: flex;
            padding: 14px 16px;
            border-bottom: 1px solid #f0f0f0;
            margin-top: 40px;
        }
        
        .skeleton-cell {
            height: 20px;
            background: linear-gradient(90deg, 
                #f5f5f5 0%, 
                #eeeeee 25%, 
                #f5f5f5 50%, 
                #eeeeee 75%,
                #f5f5f5 100%
            );
            background-size: 200% 100%;
            border-radius: 4px;
            margin-right: 12px;
            position: relative;
        }
        
        .skeleton-cell:last-child {
            margin-right: 0;
        }
        
        .skeleton-cell.image { width: 50px; height: 35px; }
        .skeleton-cell.location { width: 120px; }
        .skeleton-cell.price { width: 100px; }
        .skeleton-cell.price-per-sqm { width: 100px; }
        .skeleton-cell.size { width: 90px; }
        .skeleton-cell.station { width: 80px; }
        .skeleton-cell.score { width: 60px; }
        .skeleton-cell.ward { width: 80px; }
        .skeleton-cell.age { width: 80px; }
        .skeleton-cell.floor { width: 80px; }
        .skeleton-cell.fee { width: 100px; }
        .skeleton-cell.monthly { width: 120px; }
        .skeleton-cell.days { width: 80px; }
        .skeleton-cell.verdict { width: 70px; }
        .skeleton-cell.link { width: 50px; }
        .skeleton-cell.date { width: 100px; }
        
        @keyframes skeleton-loading {
            0% { 
                background-position: -200% 0;
            }
            100% { 
                background-position: 200% 0;
            }
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            body::before {
                width: 300px;
                height: 200px;
            }
            
            .container {
                padding: 20px 15px;
                margin: 10px;
                border-radius: 8px;
            }
            
            h1 {
                font-size: 32px;
                margin-bottom: 24px;
            }
            
            .results-info {
                flex-direction: column;
                gap: 10px;
                padding: 12px 16px;
            }
            
            td {
                padding: 10px 12px;
                font-size: 13px;
            }
            
            .price {
                font-size: 14px;
            }
            
            /* Larger touch targets */
            .filter-btn {
                padding: 6px 10px;
                font-size: 13px;
            }
            
            .link-button {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .terminal-status-bar {
                font-size: 11px;
                padding: 8px 12px;
            }
            
            .status-left, .status-right {
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    
    <div class="container">
        <h1>東京 Real Estate</h1>
        
        <div class="results-info">
            <div class="results-count" id="resultsCount">Loading properties...</div>
        </div>
        
        <div class="loading" id="loading">
            <div class="skeleton-row">
                <div class="skeleton-cell image skeleton"></div>
                <div class="skeleton-cell location skeleton"></div>
                <div class="skeleton-cell price skeleton"></div>
                <div class="skeleton-cell price-per-sqm skeleton"></div>
                <div class="skeleton-cell size skeleton"></div>
                <div class="skeleton-cell station skeleton"></div>
                <div class="skeleton-cell score skeleton"></div>
                <div class="skeleton-cell score skeleton"></div>
                <div class="skeleton-cell ward skeleton"></div>
                <div class="skeleton-cell age skeleton"></div>
                <div class="skeleton-cell floor skeleton"></div>
                <div class="skeleton-cell fee skeleton"></div>
                <div class="skeleton-cell monthly skeleton"></div>
                <div class="skeleton-cell days skeleton"></div>
                <div class="skeleton-cell verdict skeleton"></div>
                <div class="skeleton-cell link skeleton"></div>
                <div class="skeleton-cell date skeleton"></div>
            </div>
            <div class="skeleton-row">
                <div class="skeleton-cell image skeleton"></div>
                <div class="skeleton-cell location skeleton"></div>
                <div class="skeleton-cell price skeleton"></div>
                <div class="skeleton-cell price-per-sqm skeleton"></div>
                <div class="skeleton-cell size skeleton"></div>
                <div class="skeleton-cell station skeleton"></div>
                <div class="skeleton-cell score skeleton"></div>
                <div class="skeleton-cell score skeleton"></div>
                <div class="skeleton-cell ward skeleton"></div>
                <div class="skeleton-cell age skeleton"></div>
                <div class="skeleton-cell floor skeleton"></div>
                <div class="skeleton-cell fee skeleton"></div>
                <div class="skeleton-cell monthly skeleton"></div>
                <div class="skeleton-cell days skeleton"></div>
                <div class="skeleton-cell verdict skeleton"></div>
                <div class="skeleton-cell link skeleton"></div>
                <div class="skeleton-cell date skeleton"></div>
            </div>
            <div class="skeleton-row">
                <div class="skeleton-cell image skeleton"></div>
                <div class="skeleton-cell location skeleton"></div>
                <div class="skeleton-cell price skeleton"></div>
                <div class="skeleton-cell price-per-sqm skeleton"></div>
                <div class="skeleton-cell size skeleton"></div>
                <div class="skeleton-cell station skeleton"></div>
                <div class="skeleton-cell score skeleton"></div>
                <div class="skeleton-cell score skeleton"></div>
                <div class="skeleton-cell ward skeleton"></div>
                <div class="skeleton-cell age skeleton"></div>
                <div class="skeleton-cell floor skeleton"></div>
                <div class="skeleton-cell fee skeleton"></div>
                <div class="skeleton-cell monthly skeleton"></div>
                <div class="skeleton-cell days skeleton"></div>
                <div class="skeleton-cell verdict skeleton"></div>
                <div class="skeleton-cell link skeleton"></div>
                <div class="skeleton-cell date skeleton"></div>
            </div>
            <div class="skeleton-row">
                <div class="skeleton-cell image skeleton"></div>
                <div class="skeleton-cell location skeleton"></div>
                <div class="skeleton-cell price skeleton"></div>
                <div class="skeleton-cell price-per-sqm skeleton"></div>
                <div class="skeleton-cell size skeleton"></div>
                <div class="skeleton-cell station skeleton"></div>
                <div class="skeleton-cell score skeleton"></div>
                <div class="skeleton-cell score skeleton"></div>
                <div class="skeleton-cell ward skeleton"></div>
                <div class="skeleton-cell age skeleton"></div>
                <div class="skeleton-cell floor skeleton"></div>
                <div class="skeleton-cell fee skeleton"></div>
                <div class="skeleton-cell monthly skeleton"></div>
                <div class="skeleton-cell days skeleton"></div>
                <div class="skeleton-cell verdict skeleton"></div>
                <div class="skeleton-cell link skeleton"></div>
                <div class="skeleton-cell date skeleton"></div>
            </div>
        </div>
        
        <div class="table-container" id="tableContainer" style="display: none;">
            <table>
                <thead>
                    <tr>
                        <th style="width: 70px;">
                            <div class="column-header">
                                <span>Image</span>
                            </div>
                            <div class="filter-cell"></div>
                        </th>
                        <th class="sortable" style="width: 150px;">
                            <div class="column-header" onclick="sortTable('location')">
                                <span>Location</span>
                                <span class="sort-arrows" id="sort-location">▲▼</span>
                            </div>
                            <div class="filter-cell">
                                <button class="filter-btn" onclick="toggleFilter('location')">▼</button>
                                <div class="filter-dropdown" id="filter-location">
                                    <div class="filter-content" id="filter-location-content"></div>
                                    <div class="filter-actions">
                                        <button class="apply-btn" onclick="applyFilter('location')">Apply</button>
                                        <button onclick="clearFilter('location')">Clear</button>
                                    </div>
                                </div>
                            </div>
                        </th>
                        <th class="sortable" style="width: 120px;">
                            <div class="column-header" onclick="sortTable('price')">
                                <span>Price</span>
                                <span class="sort-arrows" id="sort-price">▲▼</span>
                            </div>
                            <div class="filter-cell">
                                <button class="filter-btn" onclick="toggleFilter('price')">▼</button>
                                <div class="filter-dropdown" id="filter-price">
                                    <div class="filter-content">
                                        <label>Min: <input type="number" id="price-min" placeholder="0"></label>
                                        <label>Max: <input type="number" id="price-max" placeholder="∞"></label>
                                    </div>
                                    <div class="filter-actions">
                                        <button class="apply-btn" onclick="applyFilter('price')">Apply</button>
                                        <button onclick="clearFilter('price')">Clear</button>
                                    </div>
                                </div>
                            </div>
                        </th>
                        <th class="sortable" style="width: 120px;">
                            <div class="column-header" onclick="sortTable('price_per_sqm')">
                                <span>Price/m²</span>
                                <span class="sort-arrows" id="sort-price_per_sqm">▲▼</span>
                            </div>
                            <div class="filter-cell">
                                <button class="filter-btn" onclick="toggleFilter('price_per_sqm')">▼</button>
                                <div class="filter-dropdown" id="filter-price_per_sqm">
                                    <div class="filter-content">
                                        <label>Min: <input type="number" id="price_per_sqm-min" placeholder="0"></label>
                                        <label>Max: <input type="number" id="price_per_sqm-max" placeholder="∞"></label>
                                    </div>
                                    <div class="filter-actions">
                                        <button class="apply-btn" onclick="applyFilter('price_per_sqm')">Apply</button>
                                        <button onclick="clearFilter('price_per_sqm')">Clear</button>
                                    </div>
                                </div>
                            </div>
                        </th>
                        <th class="sortable" style="width: 120px;">
                            <div class="column-header" onclick="sortTable('size')">
                                <span>Size/Bedrooms</span>
                                <span class="sort-arrows" id="sort-size">▲▼</span>
                            </div>
                            <div class="filter-cell">
                                <button class="filter-btn" onclick="toggleFilter('size')">▼</button>
                                <div class="filter-dropdown" id="filter-size">
                                    <div class="filter-content">
                                        <label>Min sqm: <input type="number" id="size-min" placeholder="0"></label>
                                        <label>Max sqm: <input type="number" id="size-max" placeholder="∞"></label>
                                    </div>
                                    <div class="filter-actions">
                                        <button class="apply-btn" onclick="applyFilter('size')">Apply</button>
                                        <button onclick="clearFilter('size')">Clear</button>
                                    </div>
                                </div>
                            </div>
                        </th>
                        <th class="sortable" style="width: 100px;">
                            <div class="column-header" onclick="sortTable('station')">
                                <span>Station</span>
                                <span class="sort-arrows" id="sort-station">▲▼</span>
                            </div>
                            <div class="filter-cell">
                                <button class="filter-btn" onclick="toggleFilter('station')">▼</button>
                                <div class="filter-dropdown" id="filter-station">
                                    <div class="filter-content">
                                        <label>Max min: <input type="number" id="station-max" placeholder="∞"></label>
                                    </div>
                                    <div class="filter-actions">
                                        <button class="apply-btn" onclick="applyFilter('station')">Apply</button>
                                        <button onclick="clearFilter('station')">Clear</button>
                                    </div>
                                </div>
                            </div>
                        </th>
                        <th class="sortable" style="width: 80px;">
                            <div class="column-header" onclick="sortTable('final_score')">
                                <span>Final Score</span>
                                <span class="sort-arrows" id="sort-final_score">▲▼</span>
                            </div>
                            <div class="filter-cell">
                                <button class="filter-btn" onclick="toggleFilter('final_score')">▼</button>
                                <div class="filter-dropdown" id="filter-final_score">
                                    <div class="filter-content">
                                        <label>Min: <input type="number" id="final_score-min" placeholder="0"></label>
                                        <label>Max: <input type="number" id="final_score-max" placeholder="100"></label>
                                    </div>
                                    <div class="filter-actions">
                                        <button class="apply-btn" onclick="applyFilter('final_score')">Apply</button>
                                        <button onclick="clearFilter('final_score')">Clear</button>
                                    </div>
                                </div>
                            </div>
                        </th>
                        <th class="sortable" style="width: 80px;">
                            <div class="column-header" onclick="sortTable('base_score')">
                                <span>Base Score</span>
                                <span class="sort-arrows" id="sort-base_score">▲▼</span>
                            </div>
                            <div class="filter-cell"></div>
                        </th>
                        <th style="width: 80px;">
                            <div class="column-header">
                                <span>Ward</span>
                            </div>
                            <div class="filter-cell">
                                <button class="filter-btn" onclick="toggleFilter('ward')">▼</button>
                                <div class="filter-dropdown" id="filter-ward">
                                    <div class="filter-content" id="filter-ward-content"></div>
                                    <div class="filter-actions">
                                        <button class="apply-btn" onclick="applyFilter('ward')">Apply</button>
                                        <button onclick="clearFilter('ward')">Clear</button>
                                    </div>
                                </div>
                            </div>
                        </th>
                        <th class="sortable" style="width: 80px;">
                            <div class="column-header" onclick="sortTable('building_age_years')">
                                <span>Age (years)</span>
                                <span class="sort-arrows" id="sort-building_age_years">▲▼</span>
                            </div>
                            <div class="filter-cell">
                                <button class="filter-btn" onclick="toggleFilter('building_age')">▼</button>
                                <div class="filter-dropdown" id="filter-building_age">
                                    <div class="filter-content">
                                        <label>Max: <input type="number" id="building_age-max" placeholder="50"></label>
                                    </div>
                                    <div class="filter-actions">
                                        <button class="apply-btn" onclick="applyFilter('building_age')">Apply</button>
                                        <button onclick="clearFilter('building_age')">Clear</button>
                                    </div>
                                </div>
                            </div>
                        </th>
                        <th class="sortable" style="width: 80px;">
                            <div class="column-header" onclick="sortTable('floor')">
                                <span>Floor</span>
                                <span class="sort-arrows" id="sort-floor">▲▼</span>
                            </div>
                            <div class="filter-cell"></div>
                        </th>
                        <th class="sortable" style="width: 100px;">
                            <div class="column-header" onclick="sortTable('management_fee')">
                                <span>Mgmt Fee</span>
                                <span class="sort-arrows" id="sort-management_fee">▲▼</span>
                            </div>
                            <div class="filter-cell"></div>
                        </th>
                        <th class="sortable" style="width: 120px;">
                            <div class="column-header" onclick="sortTable('total_monthly_costs')">
                                <span>Total Monthly</span>
                                <span class="sort-arrows" id="sort-total_monthly_costs">▲▼</span>
                            </div>
                            <div class="filter-cell"></div>
                        </th>
                        <th class="sortable" style="width: 80px;">
                            <div class="column-header" onclick="sortTable('days_on_market')">
                                <span>Days Listed</span>
                                <span class="sort-arrows" id="sort-days_on_market">▲▼</span>
                            </div>
                            <div class="filter-cell"></div>
                        </th>
                        <th style="width: 100px;">
                            <div class="column-header">
                                <span>Verdict</span>
                            </div>
                            <div class="filter-cell">
                                <button class="filter-btn" onclick="toggleFilter('verdict')">▼</button>
                                <div class="filter-dropdown" id="filter-verdict">
                                    <div class="filter-content" id="filter-verdict-content"></div>
                                    <div class="filter-actions">
                                        <button class="apply-btn" onclick="applyFilter('verdict')">Apply</button>
                                        <button onclick="clearFilter('verdict')">Clear</button>
                                    </div>
                                </div>
                            </div>
                        </th>
                        <th style="width: 80px;">
                            <div class="column-header">
                                <span>Link</span>
                            </div>
                            <div class="filter-cell"></div>
                        </th>
                        <th class="sortable" style="width: 100px;">
                            <div class="column-header" onclick="sortTable('date')">
                                <span>Date Added</span>
                                <span class="sort-arrows" id="sort-date">▲▼</span>
                            </div>
                            <div class="filter-cell"></div>
                        </th>
                    </tr>
                </thead>
                <tbody id="propertiesTable">
                </tbody>
            </table>
        </div>
        
        <div class="pagination" id="pagination" style="display: none;">
            <button id="prevButton" onclick="previousPage()">Previous</button>
            <span class="page-info" id="pageInfo"></span>
            <button id="nextButton" onclick="nextPage()">Next</button>
        </div>
    </div>
    
    <script>
        // Configuration
        const API_URL = 'https://nbgnatp0pd.execute-api.ap-northeast-1.amazonaws.com/prod/properties';
        
        // State
        let allProperties = [];
        let filteredProperties = [];
        let currentPage = 1;
        let pageSize = 50;
        let currentSort = { field: 'date', direction: 'desc' };
        let filters = {};
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadProperties();
            setupEventListeners();
        });
        
        function setupEventListeners() {
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.filter-cell')) {
                    closeAllDropdowns();
                }
            });
        }
        
        // Load all properties from API
        async function loadProperties() {
            try {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('tableContainer').style.display = 'none';
                document.getElementById('pagination').style.display = 'none';
                
                // Load all properties at once (request large limit to get all properties)
                const response = await fetch(`${API_URL}?limit=100000`);
                const data = await response.json();
                
                if (response.ok) {
                    allProperties = data.properties || [];
                    setupFilterOptions();
                    applyFiltersAndSort();
                } else {
                    console.error('Error loading properties:', data);
                    document.getElementById('resultsCount').textContent = 'Error loading properties';
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('resultsCount').textContent = 'Connection error';
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        // Setup filter dropdown options
        function setupFilterOptions() {
            // Location filter
            const locations = [...new Set(allProperties.map(p => p.district || 'Unknown').filter(l => l !== 'Unknown'))].sort();
            const locationContent = document.getElementById('filter-location-content');
            locationContent.innerHTML = locations.map(loc => 
                `<label><input type="checkbox" value="${loc}"> ${loc}</label>`
            ).join('');
            
            // Ward filter
            const wards = [...new Set(allProperties.map(p => p.ward || 'Unknown').filter(w => w !== 'Unknown'))].sort();
            const wardContent = document.getElementById('filter-ward-content');
            wardContent.innerHTML = wards.map(ward => 
                `<label><input type="checkbox" value="${ward}"> ${ward}</label>`
            ).join('');
            
            // Verdict filter
            const verdicts = [...new Set(allProperties.map(p => p.recommendation || p.verdict || 'pass'))].sort();
            const verdictContent = document.getElementById('filter-verdict-content');
            verdictContent.innerHTML = verdicts.map(verdict => 
                `<label><input type="checkbox" value="${verdict}"> ${verdict.toUpperCase()}</label>`
            ).join('');
        }
        
        // Apply filters and sorting
        function applyFiltersAndSort() {
            // Apply filters
            filteredProperties = allProperties.filter(property => {
                // Location filter
                if (filters.location && filters.location.length > 0) {
                    if (!filters.location.includes(property.district || 'Unknown')) return false;
                }
                
                // Ward filter
                if (filters.ward && filters.ward.length > 0) {
                    if (!filters.ward.includes(property.ward || 'Unknown')) return false;
                }
                
                // Building age filter
                if (filters.building_age && filters.building_age.max) {
                    const buildingAge = property.building_age_years || 999;
                    if (buildingAge > filters.building_age.max) return false;
                }
                
                // Final score filter
                if (filters.final_score) {
                    const finalScore = property.final_score || 0;
                    if (filters.final_score.min && finalScore < filters.final_score.min) return false;
                    if (filters.final_score.max && finalScore > filters.final_score.max) return false;
                }
                
                // Price filter (convert input from actual yen to 万円 for comparison)
                if (filters.price) {
                    const price = property.price || 0;
                    const minInManYen = filters.price.min ? filters.price.min / 10000 : null;
                    const maxInManYen = filters.price.max ? filters.price.max / 10000 : null;
                    if (minInManYen && price < minInManYen) return false;
                    if (maxInManYen && price > maxInManYen) return false;
                }
                
                // Price per sqm filter
                if (filters.price_per_sqm) {
                    const pricePerSqm = property.price_per_sqm || 0;
                    if (filters.price_per_sqm.min && pricePerSqm < filters.price_per_sqm.min) return false;
                    if (filters.price_per_sqm.max && pricePerSqm > filters.price_per_sqm.max) return false;
                }
                
                // Size filter
                if (filters.size) {
                    const size = property.total_sqm || 0;
                    if (filters.size.min && size < filters.size.min) return false;
                    if (filters.size.max && size > filters.size.max) return false;
                }
                
                // Station filter
                if (filters.station && filters.station.max) {
                    const station = property.station_distance_minutes || 999;
                    if (station > filters.station.max) return false;
                }
                
                // Score filter
                if (filters.score) {
                    const score = property.investment_score || 0;
                    if (filters.score.min && score < filters.score.min) return false;
                    if (filters.score.max && score > filters.score.max) return false;
                }
                
                // Verdict filter
                if (filters.verdict && filters.verdict.length > 0) {
                    const propertyVerdict = property.recommendation || property.verdict || 'pass';
                    if (!filters.verdict.includes(propertyVerdict)) return false;
                }
                
                return true;
            });
            
            // Apply sorting
            filteredProperties.sort((a, b) => {
                let aVal, bVal;
                
                switch (currentSort.field) {
                    case 'location':
                        aVal = (a.district || 'Unknown').toLowerCase();
                        bVal = (b.district || 'Unknown').toLowerCase();
                        break;
                    case 'price':
                        aVal = a.price || 0;
                        bVal = b.price || 0;
                        break;
                    case 'price_per_sqm':
                        aVal = a.price_per_sqm || 0;
                        bVal = b.price_per_sqm || 0;
                        break;
                    case 'size':
                        aVal = a.total_sqm || 0;
                        bVal = b.total_sqm || 0;
                        break;
                    case 'station':
                        aVal = a.station_distance_minutes || 999;
                        bVal = b.station_distance_minutes || 999;
                        break;
                    case 'final_score':
                        aVal = a.final_score || 0;
                        bVal = b.final_score || 0;
                        break;
                    case 'base_score':
                        aVal = a.base_score || 0;
                        bVal = b.base_score || 0;
                        break;
                    case 'building_age_years':
                        aVal = a.building_age_years || 999;
                        bVal = b.building_age_years || 999;
                        break;
                    case 'floor':
                        aVal = a.floor || 0;
                        bVal = b.floor || 0;
                        break;
                    case 'management_fee':
                        aVal = a.management_fee || 0;
                        bVal = b.management_fee || 0;
                        break;
                    case 'total_monthly_costs':
                        aVal = a.total_monthly_costs || 0;
                        bVal = b.total_monthly_costs || 0;
                        break;
                    case 'days_on_market':
                        aVal = a.days_on_market || 0;
                        bVal = b.days_on_market || 0;
                        break;
                    case 'score':
                        aVal = a.investment_score || 0;
                        bVal = b.investment_score || 0;
                        break;
                    case 'date':
                        aVal = new Date(a.analysis_date || 0);
                        bVal = new Date(b.analysis_date || 0);
                        break;
                    default:
                        return 0;
                }
                
                if (aVal < bVal) return currentSort.direction === 'asc' ? -1 : 1;
                if (aVal > bVal) return currentSort.direction === 'asc' ? 1 : -1;
                return 0;
            });
            
            currentPage = 1; // Reset to first page
            displayProperties();
            updateSortArrows();
        }
        
        // Display properties in table
        function displayProperties() {
            const tbody = document.getElementById('propertiesTable');
            const startIdx = (currentPage - 1) * pageSize;
            const endIdx = startIdx + pageSize;
            const pageProperties = filteredProperties.slice(startIdx, endIdx);
            
            tbody.innerHTML = pageProperties.map(property => {
                const location = property.district || '<span class="skull-icon">☠</span>';
                const price = formatPrice(property.price);
                const pricePerSqm = formatPricePerSqm(property.price_per_sqm);
                const size = `${Math.round(property.total_sqm || 0)}m² / ${property.num_bedrooms || 0}BR`;
                const station = property.station_distance_minutes ? `${property.station_distance_minutes} min` : `<span class="skull-icon">☠</span>`;
                const finalScore = Math.round(property.final_score || 0);
                const baseScore = Math.round(property.base_score || 0);
                const ward = property.ward || '<span class="skull-icon">☠</span>';
                const buildingAge = property.building_age_years || '<span class="skull-icon">☠</span>';
                const floor = property.floor || '<span class="skull-icon">☠</span>';
                const managementFee = formatPrice(property.management_fee);
                const totalMonthlyCosts = formatPrice(property.total_monthly_costs);
                const daysOnMarket = property.days_on_market || '<span class="skull-icon">☠</span>';
                const verdict = property.recommendation || property.verdict || 'pass';
                const date = formatDate(property.analysis_date);
                const hasLink = property.listing_url && property.listing_url.trim();
                const imageDisplay = getImageDisplay(property.image_urls);
                
                return `
                    <tr>
                        <td>
                            ${imageDisplay}
                        </td>
                        <td>${location}</td>
                        <td class="price">${price}</td>
                        <td class="price">${pricePerSqm}</td>
                        <td>${size}</td>
                        <td>${station}</td>
                        <td style="text-align: center; font-weight: 700; font-size: 18px; color: #00ff55; text-shadow: 0 0 3px #00ff55, 0 0 6px rgba(0, 255, 85, 0.5), 0 0 12px rgba(0, 255, 85, 0.3); font-family: 'JetBrains Mono', monospace;">[${finalScore}]</td>
                        <td style="text-align: center; font-weight: 700; font-size: 16px; color: #ff6600; text-shadow: 0 0 3px #ff6600; font-family: 'JetBrains Mono', monospace;">[${baseScore}]</td>
                        <td>${ward}</td>
                        <td style="text-align: center;">${buildingAge}</td>
                        <td style="text-align: center;">${floor}</td>
                        <td class="price">${managementFee}</td>
                        <td class="price">${totalMonthlyCosts}</td>
                        <td style="text-align: center;">${daysOnMarket}</td>
                        <td>
                            <span class="verdict verdict-${verdict}">${verdict.toUpperCase()}</span>
                        </td>
                        <td style="text-align: center;">
                            ${hasLink ? 
                                `<a href="${property.listing_url}" target="_blank" class="link-button">View</a>` :
                                `<span class="skull-icon">☠</span>`
                            }
                        </td>
                        <td>${date}</td>
                    </tr>
                `;
            }).join('');
            
            // Update counts and pagination
            const totalCount = filteredProperties.length;
            const showing = Math.min(endIdx, totalCount);
            const activeFilters = Object.keys(filters).filter(key => 
                filters[key] && (Array.isArray(filters[key]) ? filters[key].length > 0 : true)
            ).length;
            
            document.getElementById('resultsCount').textContent = 
                `Showing ${startIdx + 1}-${showing} of ${totalCount} properties` +
                (activeFilters > 0 ? ` (${activeFilters} filters active)` : '');
            
            updatePagination();
            
            document.getElementById('tableContainer').style.display = 'block';
            document.getElementById('pagination').style.display = 'flex';
            
            // Update status bar
            updatePropertiesStatus();
        }
        
        // Sorting
        function sortTable(field) {
            if (currentSort.field === field) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.field = field;
                currentSort.direction = 'asc';
            }
            applyFiltersAndSort();
        }
        
        function updateSortArrows() {
            // Reset all arrows
            document.querySelectorAll('.sort-arrows').forEach(arrow => {
                arrow.classList.remove('active');
                arrow.textContent = '▲▼';
            });
            
            // Set active arrow
            const activeArrow = document.getElementById(`sort-${currentSort.field}`);
            if (activeArrow) {
                activeArrow.classList.add('active');
                activeArrow.textContent = currentSort.direction === 'asc' ? '▲' : '▼';
            }
        }
        
        // Filter management
        function toggleFilter(filterType) {
            closeAllDropdowns();
            const dropdown = document.getElementById(`filter-${filterType}`);
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }
        
        function closeAllDropdowns() {
            document.querySelectorAll('.filter-dropdown').forEach(dropdown => {
                dropdown.style.display = 'none';
            });
        }
        
        function applyFilter(filterType) {
            switch (filterType) {
                case 'location':
                    const locationChecked = Array.from(document.querySelectorAll('#filter-location-content input:checked'))
                        .map(cb => cb.value);
                    filters.location = locationChecked.length > 0 ? locationChecked : null;
                    break;
                    
                case 'price':
                    const priceMin = parseFloat(document.getElementById('price-min').value) || null;
                    const priceMax = parseFloat(document.getElementById('price-max').value) || null;
                    filters.price = (priceMin || priceMax) ? { min: priceMin, max: priceMax } : null;
                    break;
                    
                case 'price_per_sqm':
                    const pricePerSqmMin = parseFloat(document.getElementById('price_per_sqm-min').value) || null;
                    const pricePerSqmMax = parseFloat(document.getElementById('price_per_sqm-max').value) || null;
                    filters.price_per_sqm = (pricePerSqmMin || pricePerSqmMax) ? { min: pricePerSqmMin, max: pricePerSqmMax } : null;
                    break;
                    
                case 'size':
                    const sizeMin = parseFloat(document.getElementById('size-min').value) || null;
                    const sizeMax = parseFloat(document.getElementById('size-max').value) || null;
                    filters.size = (sizeMin || sizeMax) ? { min: sizeMin, max: sizeMax } : null;
                    break;
                    
                case 'station':
                    const stationMax = parseFloat(document.getElementById('station-max').value) || null;
                    filters.station = stationMax ? { max: stationMax } : null;
                    break;
                    
                case 'score':
                    const scoreMin = parseFloat(document.getElementById('score-min').value) || null;
                    const scoreMax = parseFloat(document.getElementById('score-max').value) || null;
                    filters.score = (scoreMin || scoreMax) ? { min: scoreMin, max: scoreMax } : null;
                    break;
                    
                case 'verdict':
                    const verdictChecked = Array.from(document.querySelectorAll('#filter-verdict-content input:checked'))
                        .map(cb => cb.value);
                    filters.verdict = verdictChecked.length > 0 ? verdictChecked : null;
                    break;
                    
                case 'ward':
                    const wardChecked = Array.from(document.querySelectorAll('#filter-ward-content input:checked'))
                        .map(cb => cb.value);
                    filters.ward = wardChecked.length > 0 ? wardChecked : null;
                    break;
                    
                case 'building_age':
                    const buildingAgeMax = parseFloat(document.getElementById('building_age-max').value) || null;
                    filters.building_age = buildingAgeMax ? { max: buildingAgeMax } : null;
                    break;
                    
                case 'final_score':
                    const finalScoreMin = parseFloat(document.getElementById('final_score-min').value) || null;
                    const finalScoreMax = parseFloat(document.getElementById('final_score-max').value) || null;
                    filters.final_score = (finalScoreMin || finalScoreMax) ? { min: finalScoreMin, max: finalScoreMax } : null;
                    break;
            }
            
            updateFilterButtonState(filterType);
            closeAllDropdowns();
            applyFiltersAndSort();
        }
        
        function clearFilter(filterType) {
            filters[filterType] = null;
            
            // Clear UI elements
            switch (filterType) {
                case 'location':
                    document.querySelectorAll('#filter-location-content input').forEach(cb => cb.checked = false);
                    break;
                case 'price':
                    document.getElementById('price-min').value = '';
                    document.getElementById('price-max').value = '';
                    break;
                case 'price_per_sqm':
                    document.getElementById('price_per_sqm-min').value = '';
                    document.getElementById('price_per_sqm-max').value = '';
                    break;
                case 'size':
                    document.getElementById('size-min').value = '';
                    document.getElementById('size-max').value = '';
                    break;
                case 'station':
                    document.getElementById('station-max').value = '';
                    break;
                case 'score':
                    document.getElementById('score-min').value = '';
                    document.getElementById('score-max').value = '';
                    break;
                case 'verdict':
                    document.querySelectorAll('#filter-verdict-content input').forEach(cb => cb.checked = false);
                    break;
                case 'ward':
                    document.querySelectorAll('#filter-ward-content input').forEach(cb => cb.checked = false);
                    break;
                case 'building_age':
                    document.getElementById('building_age-max').value = '';
                    break;
                case 'final_score':
                    document.getElementById('final_score-min').value = '';
                    document.getElementById('final_score-max').value = '';
                    break;
            }
            
            updateFilterButtonState(filterType);
            closeAllDropdowns();
            applyFiltersAndSort();
        }
        
        function updateFilterButtonState(filterType) {
            const button = document.querySelector(`button[onclick="toggleFilter('${filterType}')"]`);
            const hasFilter = filters[filterType] && 
                (Array.isArray(filters[filterType]) ? filters[filterType].length > 0 : true);
            
            if (hasFilter) {
                button.classList.add('active');
            } else {
                button.classList.remove('active');
            }
        }
        
        // Pagination
        function updatePagination() {
            const totalPages = Math.ceil(filteredProperties.length / pageSize);
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            document.getElementById('prevButton').disabled = currentPage === 1;
            document.getElementById('nextButton').disabled = currentPage === totalPages || totalPages === 0;
        }
        
        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                displayProperties();
            }
        }
        
        function nextPage() {
            const totalPages = Math.ceil(filteredProperties.length / pageSize);
            if (currentPage < totalPages) {
                currentPage++;
                displayProperties();
            }
        }
        
        // Utility functions
        function formatPrice(price) {
            if (!price) return '¥ 0';
            // Multiply by 10,000 (prices are stored in 万円)
            const actualPrice = price * 10000;
            return '¥ ' + Math.round(actualPrice).toLocaleString();
        }
        
        function formatPricePerSqm(pricePerSqm) {
            if (!pricePerSqm) return '¥ 0/m²';
            return '¥ ' + Math.round(pricePerSqm).toLocaleString() + '/m²';
        }
        
        function getImageDisplay(imageUrls) {
            if (imageUrls && imageUrls.length > 0) {
                return `<img src="${imageUrls[0]}" alt="Property" class="property-image" onerror="this.style.display='none'; this.nextSibling.style.display='flex';" style="width: 50px; height: 38px; object-fit: cover; border-radius: 4px; border: 2px solid #b87333;"><div class="property-image" style="display: none;">☠</div>`;
            } else {
                return '<div class="property-image">☠</div>';
            }
        }
        
        function formatDate(dateString) {
            if (!dateString) return '<span class="skull-icon">☠</span>';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
            } catch {
                return '<span class="skull-icon">☠</span>';
            }
        }
        
        // Status Bar Updates
        let startTime = Date.now();
        
        function updateStatusBar() {
            // Update property counts
            const totalProperties = allProperties.length;
            const filteredCount = filteredProperties.length;
            document.getElementById('statusProperties').textContent = `PROPERTIES: ${totalProperties}`;
            document.getElementById('statusFiltered').textContent = `FILTERED: ${filteredCount}`;
            
            // Update uptime
            const elapsed = Date.now() - startTime;
            const hours = Math.floor(elapsed / 3600000).toString().padStart(2, '0');
            const minutes = Math.floor((elapsed % 3600000) / 60000).toString().padStart(2, '0');
            const seconds = Math.floor((elapsed % 60000) / 1000).toString().padStart(2, '0');
            document.getElementById('statusUptime').textContent = `UPTIME: ${hours}:${minutes}:${seconds}`;
            
            // Update Tokyo time
            const tokyoTime = new Date().toLocaleTimeString('en-US', {
                timeZone: 'Asia/Tokyo',
                hour12: false,
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('statusTime').textContent = `TOKYO TIME: ${tokyoTime}`;
        }
        
        // Update status bar every second
        setInterval(updateStatusBar, 1000);
        
        // Update status when properties change
        function updatePropertiesStatus() {
            updateStatusBar();
        }
    </script>
    
    <!-- Terminal Status Bar -->
    <div class="terminal-status-bar">
        <div class="status-left">
            <span class="status-item" id="statusProperties">PROPERTIES: --</span>
            <span class="status-item" id="statusFiltered">FILTERED: --</span>
            <span class="status-item" id="statusUptime">UPTIME: 00:00:00</span>
        </div>
        <div class="status-right">
            <span class="status-item" id="statusTime">TOKYO TIME: --:--</span>
        </div>
    </div>
</body>
</html>